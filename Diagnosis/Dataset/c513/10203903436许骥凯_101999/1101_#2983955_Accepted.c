#include<stdio.h>
#include<string.h>
int BT[8][8][8] = 
{
    {
        {1, 1, 0, 0, 0, 0, 1, 1}, {1, 1, 0, 0, 0, 0, 1, 1}, {1, 1, 1, 1, 1, 1, 0, 0}, {1, 1, 1, 1, 1, 1, 0, 0},
        {1, 1, 1, 1, 1, 1, 1 ,1}, {1, 1, 1, 1, 1, 1, 1, 1}, {1, 1, 0, 0, 0, 0, 1, 1}, {1, 1, 0, 0, 0, 0, 1, 1}
    },
    {
        {1, 1, 0, 0, 0, 0, 1, 1}, {0, 1, 0, 0, 0, 0, 0, 1}, {1, 1, 1, 1, 1, 1, 0, 0}, {0, 1, 0, 1, 0, 1, 0, 0},
        {1, 1, 1, 1, 1, 1, 1, 1}, {0, 1, 0, 1, 0, 1, 0, 1}, {1, 1, 0, 0, 0, 0, 1, 1}, {0, 1, 0, 0, 0, 0, 0, 1}               
    },
    {
        {1, 1, 1, 1, 1, 1, 0, 0}, {1, 1, 1, 1, 1, 1, 0, 0}, {1, 1, 1, 1, 1, 1, 0, 0}, {1, 1, 1, 1, 1, 1, 0, 0},
        {1, 1, 1, 1, 1, 1, 0, 0}, {1, 1, 1, 1, 1, 1, 0, 0}, {1, 1, 0, 0, 1, 1, 0, 0}, {1, 1, 0, 0, 1, 1, 0, 0}
    },
    {
        {1, 1, 1, 1, 1, 1, 0, 0}, {0, 1, 0, 1, 0, 1, 0, 0}, {1, 1, 1, 1, 1, 1, 0, 0}, {0, 1, 0, 1, 0, 1, 0, 0},
        {1, 1, 1, 1, 1, 1, 0, 0}, {0, 1, 0, 1, 0, 1, 0, 0}, {1, 1, 0, 0, 1, 1, 0, 0}, {0, 1, 0, 0, 0, 1, 0, 0}
    },
    {
        {1, 1, 1, 1, 1, 1, 1, 1}, {1, 1, 1, 1, 1, 1, 1, 1}, {1, 1, 1, 1, 1, 1, 0, 0}, {1, 1, 1, 1, 1, 1, 0, 0},
        {0, 0, 0, 0, 1, 1, 1, 1}, {0, 0, 0, 0, 1, 1, 1, 1}, {0, 0, 0, 0, 1, 1, 1, 1}, {0, 0, 0, 0, 1, 1, 1, 1}
    },
    {
        {1, 1, 1, 1, 1, 1, 1, 1}, {0, 1, 0, 1, 0, 1, 0, 1}, {1, 1, 1, 1, 1, 1, 0, 0}, {0, 1, 0, 1, 0, 1, 0, 0},
        {0, 0, 0, 0, 1, 1, 1, 1}, {0, 0, 0, 0, 0, 1, 0, 1}, {0, 0, 0, 0, 1, 1, 1, 1}, {0, 0, 0, 0, 0, 1, 0, 1}        
    },
    {
        {1, 1, 0, 0, 0, 0, 1, 1}, {1, 1, 0, 0, 0, 0, 1, 1}, {1, 1, 0, 0, 1, 1, 0, 0}, {1, 1, 0, 0, 1, 1, 0, 0},
        {0, 0, 0, 0, 1, 1, 1, 1}, {0, 0, 0, 0, 1, 1, 1, 1}, {0, 0, 0, 0, 0, 0, 1, 1}, {0, 0, 0, 0, 0, 0, 1, 1}
    },
    {
        {1, 1, 0, 0, 0, 0, 1, 1}, {0, 1, 0, 0, 0, 0, 0, 1}, {1, 1, 0, 0, 1, 1, 0, 0}, {0, 1, 0, 0, 0, 1, 0, 0},
        {0, 0, 0, 0, 1, 1, 1, 1}, {0, 0, 0, 0, 0, 1, 0, 1}, {0, 0, 0, 0, 0, 0, 1, 1}, {0, 0, 0, 0, 0, 0, 0, 1}
    }
};

char *out[8] = {"A+", "A-", "AB+", "AB-", "B+", "B-", "O+", "O-"};
int map[500];

void init(){
    memset(map, -1, 500 * 4);
    map['A' + '+'] = 0; map['A' + '-'] = 1;
    map['A' + 'B' + '+'] = 2; map['A' + 'B' + '-'] = 3;
    map['B' + '+'] = 4; map['B' + '-'] = 5;
    map['O' + '+'] = 6; map['O' + '-'] = 7; 
}

int trans(const char *s){
    int res = 0;
    for (int i = 0; i != strlen(s); i++)
        res += s[i];
    return map[res];
}

void output(char **s, int len){
    if (len == 0) printf("impossible");
    else if (len == 1) printf("%s", s[0]);
    else{
        printf("{");
        for (int i = 0; i != len; i++)
            printf("%s%c", s[i], i == len - 1? '}': ',');
    }
}

int main(){
    init();
    int pro; scanf("%d", &pro);
    for (int i = 0; i != pro; i++){
        char mo[5], fa[5], ch[5];
        scanf("%s%s%s", mo,fa,ch);
        char *res[8]; int rlen = 0;
        if (!strcmp(mo, "?")){
            int fidx = trans(fa), chidx = trans(ch);
            for (int j = 0; j != 8; j++)
                if (BT[j][fidx][chidx])
                    res[rlen++] = out[j];
            output(res, rlen); printf(" %s %s\n", fa, ch);
        }
        else if (!strcmp(fa, "?")){
            int midx = trans(mo), chidx = trans(ch);
            for (int j = 0; j != 8; j++)
                if (BT[midx][j][chidx])
                    res[rlen++] = out[j];
            printf("%s ", mo); output(res, rlen); printf(" %s\n", ch); 
        }
        else if (!strcmp(ch, "?")){
            int midx = trans(mo), fidx = trans(fa);
            for (int j = 0; j != 8; j++)
                if (BT[midx][fidx][j])
                    res[rlen++] = out[j];
            printf("%s %s ", mo, fa); output(res, rlen); printf("\n");
        }
    }
}